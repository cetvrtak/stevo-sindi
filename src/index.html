<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fruit & Vegetable Code Quiz</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      .quiz-container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
      }
      .question {
        font-size: 20px;
        margin-bottom: 20px;
      }
      .options button {
        display: block;
        width: 100%;
        padding: 10px;
        margin: 5px 0;
        font-size: 18px;
        cursor: pointer;
      }
      #next-btn {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 18px;
        cursor: pointer;
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Fruit & Vegetable Code Quiz</h1>
    <div class="quiz-container">
      <div class="question" id="question">Loading question...</div>
      <div class="options" id="options"></div>
      <button id="next-btn">Next Question</button>
    </div>

    <script>
      const sheetUrl =
        'https://docs.google.com/spreadsheets/d/1mgMzDOLZRQ9QMCbL9ufHt6Jh4XUc6LPDqNNrwua_l1E/gviz/tq?tqx=out:json';
      let quizData = [];
      let currentQuestionIndex = 0;
      let score = 0;

      async function fetchQuizData() {
        try {
          const response = await fetch(sheetUrl);
          const text = await response.text();
          const jsonData = JSON.parse(text.substring(47, text.length - 2));

          quizData = jsonData.table.rows.map((row) => ({
            code: row.c[0].v.toString(),
            name: row.c[1].v,
          }));
          startQuiz();
        } catch (error) {
          console.error('Error fetching data: ', error);
        }
      }

      function startQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        showQuestion();
      }

      function showQuestion() {
        if (currentQuestionIndex >= quizData.length) {
          document.getElementById(
            'question'
          ).innerText = `Quiz Completed! Your Score: ${score}/${quizData.length}`;
          document.getElementById('options').innerHTML = '';
          document.getElementById('next-btn').style.display = 'none';
          return;
        }

        const questionData = quizData[currentQuestionIndex];
        document.getElementById(
          'question'
        ).innerText = `What is the code for ${questionData.name}?`;

        let options = [...quizData];
        options = options.sort(() => 0.5 - Math.random()).slice(0, 4);
        if (!options.some((opt) => opt.code === questionData.code)) {
          options[0] = questionData;
        }
        options = options.sort(() => 0.5 - Math.random());

        document.getElementById('options').innerHTML = options
          .map(
            (opt) =>
              `<button onclick="checkAnswer('${opt.code}', '${questionData.code}')">${opt.code}</button>`
          )
          .join('');

        document.getElementById('next-btn').style.display = 'none';
      }

      function checkAnswer(selectedCode, correctCode) {
        if (selectedCode === correctCode) {
          score++;
          alert('Correct!');
        } else {
          alert(`Wrong! The correct code was ${correctCode}`);
        }
        document.getElementById('next-btn').style.display = 'block';
      }

      document.getElementById('next-btn').addEventListener('click', () => {
        currentQuestionIndex++;
        showQuestion();
      });

      fetchQuizData();
    </script>
  </body>
</html>
